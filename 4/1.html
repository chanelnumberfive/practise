<!doctype html>
<html style="height:100%;">
<head>
<meta charset="utf-8">
<title>a scene</title>
<style>
* {
	padding: 0;
	margin: 0;
}
</style>
</head>

<body style="100%;overflow:hidden;">
<script type="application/ecmascript" src="../js/three.min.js"></script>
<script type="application/ecmascript" src="../js/dat.gui.min.js"></script> 
<script type="application/ecmascript" src="../js/stats.min.js"></script> 
<script type="application/javascript">	
+function(THREE){
	'use strict';
	
	var renderer,
		camera,
		scene,
		control,
		stats,
		loader=new THREE.TextureLoader();
	
	function init(){
		scene=new THREE.Scene();
		
		camera = new THREE.PerspectiveCamera(45, window.innerWidth / window.innerHeight, 0.1, 1000);
		camera.position.x = 10;
        camera.position.y = 14;
        camera.position.z = 20;
        camera.lookAt(scene.position);
		
		renderer = new THREE.WebGLRenderer();
        renderer.setClearColor(0x000000, 1.0);
        renderer.setSize(window.innerWidth, window.innerHeight);
        renderer.shadowMapEnabled = true;
		document.body.appendChild(renderer.domElement);
		
		// add a plane
		var planeGeometry = new THREE.PlaneGeometry(100, 100);
        var planeMaterial = new THREE.MeshPhongMaterial({color: 0x3333ff});
        var plane = new THREE.Mesh(planeGeometry, planeMaterial);
        plane.receiveShadow = true;
        plane.rotation.x = -0.5 * Math.PI;
        plane.position.x = 0;
        plane.position.y = -2;
        plane.position.z = 0;
        scene.add(plane);
		
		// create a particle
		var cubeGeometry = new THREE.BoxGeometry(3,6, 3, 15, 25, 15);
		var cubeMaterial=new THREE.ParticleBasicMaterial();
		cubeMaterial.map=loader.load('../images/particle.png');
		cubeMaterial.blending= THREE.AdditiveBlending;
        cubeMaterial.transparent = true;
        cubeMaterial.size=1.0;
        var particle= new THREE.ParticleSystem(cubeGeometry, cubeMaterial);
        particle.sortParticles = true;
        particle.name='cube';
        particle.position.x=1.75;
        scene.add(particle);
		
		// create the second particle
		var particleMaterial=cubeMaterial.clone();
		particleMaterial.map=loader.load('../images/particle2.png');
		var particleSysterm = new THREE.ParticleSystem(cubeGeometry, particleMaterial);
        particleSysterm.name = 'cube2';
        particleSysterm.position.x=-1.75;
        scene.add(particleSysterm);
		
		var spotLight = new THREE.SpotLight(0xffffff);
        spotLight.position.set(10, 20, 20);
        spotLight.shadow.camera.near = 20;
        spotLight.shadow.camera.far = 50;
        spotLight.castShadow = true;
		//scene.add(new THREE.CameraHelper(spotLight.shadow.camera));
        scene.add(spotLight);
		
		control = new function() {
            this.rotationSpeed = 0.005;
            this.opacity = 0.6;
        };
		addControlGui(control);
        addStatsObject();
		render();
	}
	
	function addControlGui(controlObject) {
        var gui = new dat.GUI();
        gui.add(controlObject, 'rotationSpeed', -0.01, 0.01);
    }

    function addStatsObject() {
        stats = new Stats();
        stats.setMode(0);

        stats.domElement.style.position = 'absolute';
        stats.domElement.style.left = '0px';
        stats.domElement.style.top = '0px';

        document.body.appendChild( stats.domElement );
    }
	
	function handleResize() {
        camera.aspect = window.innerWidth / window.innerHeight;
        camera.updateProjectionMatrix();
        renderer.setSize(window.innerWidth, window.innerHeight);
    }
	
	function render() {
        // update the camera
        var rotSpeed = control.rotationSpeed;
        camera.position.x = camera.position.x * Math.cos(rotSpeed) + camera.position.z * Math.sin(rotSpeed);
        camera.position.z = camera.position.z * Math.cos(rotSpeed) - camera.position.x * Math.sin(rotSpeed);
        camera.lookAt(scene.position);

        stats.update();
        renderer.render(scene, camera);

        requestAnimationFrame(render);
    }
	
	
	var context;
    var sourceNode;
    var analyser;
    var analyser2;

	function setupSound(){
		context=new AudioContext();
		var sourceCode=context.createBufferSource(),
			splitter=context.createBufferSplitter(),
			analyser=context.createAnalyser(),
			analyser2=context.createAnalyser();
		analyser.smoothingTimeConstant=0.4;
		analyser2.smoothingTimeConstant=0.4;
		analyser.fftSize=1024;
		analyser2.fftSize=1024;
		spurceCode.conect(splitter);
		splitter.conect(analyser,0);
		splitter.conect(analyser2,1);
		sourceCode.conect(context.destination);
	}
	
    window.onload = init;
    window.addEventListener('resize', handleResize, false);
}(window.THREE);
</script>
</body>
</html>
